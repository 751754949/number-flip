{"version":3,"file":"number-flip.min.js","sources":["../flip.js"],"sourcesContent":["const { g } = require('gelerator')\r\n\r\nconst maxLenNum = (aNum, bNum) => (aNum > bNum ? aNum : bNum).toString().length\r\n\r\nconst num2PadNumArr = (num, len) => {\r\n  const padLeftStr = (rawStr, lenNum) => (rawStr.length < lenNum\r\n    ? padLeftStr('0' + rawStr, lenNum)\r\n    : rawStr)\r\n  const str2NumArr = rawStr => rawStr.split('').map(Number)\r\n  return str2NumArr(padLeftStr(num.toString(), len)).reverse()\r\n}\r\n\r\nmodule.exports = class flip {\r\n  constructor({\r\n    node,\r\n    from = 0,\r\n    to,\r\n    duration = .5,\r\n    delay,\r\n    easeFn = (pos => (pos /= .5) < 1\r\n                ? .5 * Math.pow(pos, 3)\r\n                : .5 * (Math.pow((pos - 2), 3) + 2)),\r\n    systemArr = [...Array(10).keys()],\r\n    direct = true\r\n  }) {\r\n    this.beforeArr = []\r\n    this.afterArr = []\r\n    this.ctnrArr = []\r\n    this.duration = duration * 1000\r\n    this.systemArr = systemArr\r\n    this.easeFn = easeFn\r\n    this.from = from\r\n    this.to = to || 0\r\n    this.node = node\r\n    this.direct = direct\r\n    this._initHTML(maxLenNum(this.from, this.to))\r\n    if (to === undefined) return\r\n    if (delay) setTimeout(() => this.flipTo({to: this.to, direct}), delay * 1000)\r\n    else this.flipTo({to: this.to, direct})\r\n  }\r\n\r\n  _initHTML(digits) {\r\n    this.node.classList.add('number-flip')\r\n    this.node.style.position = 'relative'\r\n    this.node.style.overflow = 'hidden'\r\n    ;[...Array(digits).keys()].forEach(i => {\r\n      const ctnr = g(`ctnr ctnr${i}`)(\r\n        ...this.systemArr.map(i => g('digit')(i)),\r\n        g('digit')(this.systemArr[0])\r\n      )\r\n      ctnr.style.position = 'relative'\r\n      ctnr.style.display = 'inline-block'\r\n      this.ctnrArr.unshift(ctnr)\r\n      this.node.appendChild(ctnr)\r\n      this.beforeArr.push(0)\r\n    })\r\n    this.height = this.ctnrArr[0].clientHeight / (this.systemArr.length + 1)\r\n    this.node.style.height = this.height + 'px'\r\n    for (let d = 0, len = this.ctnrArr.length; d < len; d += 1)\r\n      this._draw({\r\n        digit: d,\r\n        per: 1,\r\n        alter: ~~(this.from / Math.pow(10, d))\r\n      })\r\n  }\r\n\r\n  _draw({per, alter, digit}) {\r\n    const from = this.beforeArr[digit]\r\n    const modNum = ((per * alter + from) % 10 + 10) % 10\r\n    const translateY = `translateY(${- modNum * this.height}px)`\r\n    this.ctnrArr[digit].style.webkitTransform = translateY\r\n    this.ctnrArr[digit].style.transform = translateY\r\n  }\r\n\r\n  flipTo({\r\n    to,\r\n    duration,\r\n    easeFn,\r\n    direct = true\r\n  }) {\r\n    const len = this.ctnrArr.length\r\n    this.beforeArr = num2PadNumArr(this.from, len)\r\n    this.afterArr = num2PadNumArr(to, len)\r\n    const draw = per => {\r\n      let temp = 0\r\n      for (let d = this.ctnrArr.length - 1; d >= 0; d -= 1) {\r\n        let alter = this.afterArr[d] - this.beforeArr[d]\r\n        temp += alter\r\n        const fn = easeFn || this.easeFn\r\n        this._draw({\r\n          digit: d,\r\n          per: fn(per),\r\n          alter: direct ? alter : temp\r\n        })\r\n        temp *= 10\r\n      }\r\n    }\r\n    const start = performance.now()\r\n    const dur = (duration * 1000) || this.duration\r\n    const tick = now => {\r\n      let elapsed = now - start\r\n      draw(elapsed / dur)\r\n      if (elapsed < dur) requestAnimationFrame(tick)\r\n      else {\r\n        this.from = to\r\n        draw(1)\r\n      }\r\n    }\r\n    requestAnimationFrame(tick)\r\n  }\r\n}"],"names":["g","require","maxLenNum","aNum","bNum","toString","length","num2PadNumArr","num","len","padLeftStr","rawStr","lenNum","split","map","Number","reverse","module","exports","node","from","to","duration","delay","easeFn","pos","Math","pow","systemArr","Array","keys","direct","beforeArr","afterArr","ctnrArr","_initHTML","this","undefined","setTimeout","_this","flipTo","digits","classList","add","style","position","overflow","forEach","ctnr","i","_this2","display","unshift","appendChild","push","height","clientHeight","d","_draw","per","alter","digit","translateY","webkitTransform","transform","draw","temp","_this3","fn","start","performance","now","dur","tick","elapsed","requestAnimationFrame"],"mappings":"spBAAQA,EAAMC,QAAQ,aAAdD,EAEFE,EAAY,SAACC,EAAMC,UAAUD,EAAOC,EAAOD,EAAOC,GAAMC,WAAWC,QAEnEC,EAAgB,SAACC,EAAKC,kBACP,SAAbC,EAAcC,EAAQC,UAAYD,EAAOL,OAASM,EACpDF,EAAW,IAAMC,EAAQC,GACzBD,EAEcD,CAAWF,EAAIH,WAAYI,GADhBE,EAAOE,MAAM,IAAIC,IAAIC,SACCC,WAGrDC,OAAOC,QAAP,oCAEIC,IAAAA,SACAC,KAAAA,aAAO,IACPC,IAAAA,OACAC,SAAAA,aAAW,KACXC,IAAAA,UACAC,OAAAA,aAAU,mBAAQC,GAAO,IAAM,EACjB,GAAKC,KAAKC,IAAIF,EAAK,GACnB,IAAMC,KAAKC,IAAKF,EAAM,EAAI,GAAK,UAC7CG,UAAAA,eAAgBC,MAAM,IAAIC,cAC1BC,OAAAA,2HAEKC,kBACAC,iBACAC,gBACAZ,SAAsB,IAAXA,OACXM,UAAYA,OACZJ,OAASA,OACTJ,KAAOA,OACPC,GAAKA,GAAM,OACXF,KAAOA,OACPY,OAASA,OACTI,UAAUjC,EAAUkC,KAAKhB,KAAMgB,KAAKf,UAC9BgB,IAAPhB,IACAE,EAAOe,WAAW,kBAAMC,EAAKC,WAAYD,EAAKlB,eAAsB,IAARE,GAC3Da,KAAKI,WAAYJ,KAAKf,wEAGnBoB,mBACHtB,KAAKuB,UAAUC,IAAI,oBACnBxB,KAAKyB,MAAMC,SAAW,gBACtB1B,KAAKyB,MAAME,SAAW,WACtBjB,MAAMY,GAAQX,QAAQiB,QAAQ,gBAC3BC,EAAOhD,qBAAciD,mBACtBC,EAAKtB,UAAUd,IAAI,mBAAKd,EAAE,QAAFA,CAAWiD,cACtCjD,EAAE,QAAFA,CAAWkD,EAAKtB,UAAU,SAEvBgB,MAAMC,SAAW,aACjBD,MAAMO,QAAU,iBAChBjB,QAAQkB,QAAQJ,KAChB7B,KAAKkC,YAAYL,KACjBhB,UAAUsB,KAAK,UAEjBC,OAASnB,KAAKF,QAAQ,GAAGsB,cAAgBpB,KAAKR,UAAUtB,OAAS,QACjEa,KAAKyB,MAAMW,OAASnB,KAAKmB,OAAS,SAClC,IAAIE,EAAI,EAAGhD,EAAM2B,KAAKF,QAAQ5B,OAAQmD,EAAIhD,EAAKgD,GAAK,OAClDC,aACID,MACF,WACKrB,KAAKhB,KAAOM,KAAKC,IAAI,GAAI8B,2CAIlCE,IAAAA,IAAKC,IAAAA,MAAOC,IAAAA,MACXzC,EAAOgB,KAAKJ,UAAU6B,GAEtBC,2BADWH,EAAMC,EAAQxC,GAAQ,GAAK,IAAM,IACNgB,KAAKmB,mBAC5CrB,QAAQ2B,GAAOjB,MAAMmB,gBAAkBD,OACvC5B,QAAQ2B,GAAOjB,MAAMoB,UAAYF,+CAItCzC,IAAAA,GACAC,IAAAA,SACAE,IAAAA,WACAO,OAAAA,gBAEMtB,EAAM2B,KAAKF,QAAQ5B,YACpB0B,UAAYzB,EAAc6B,KAAKhB,KAAMX,QACrCwB,SAAW1B,EAAcc,EAAIZ,OAC5BwD,EAAO,oBACPC,EAAO,EACFT,EAAIU,EAAKjC,QAAQ5B,OAAS,EAAGmD,GAAK,EAAGA,GAAK,EAAG,KAChDG,EAAQO,EAAKlC,SAASwB,GAAKU,EAAKnC,UAAUyB,MACtCG,MACFQ,EAAK5C,GAAU2C,EAAK3C,SACrBkC,aACID,MACFW,EAAGT,SACD5B,EAAS6B,EAAQM,OAElB,KAGNG,EAAQC,YAAYC,MACpBC,EAAkB,IAAXlD,GAAoBc,KAAKd,+BACzB,SAAPmD,SACAC,EAAUH,EAAMF,IACfK,EAAUF,GACXE,EAAUF,EAAKG,sBAAsBF,MAElCrD,KAAOC,IACP,wCA7Fb"}